分布式定时任务怎么处理？有哪些方式

## 背景

我公司是一个快速发展的创业公司，目前有200人，主要业务是旅游和酒店相关的，应用迭代更新周期比较快，因此，开发人员花费了更多的时间去更=跟上迭代的步伐，而缺乏了对整个系统的把控。

**没有集群之前，公司定时任务的实现方式**

在初期应用的访问量并不是那么大，一台服务器完全满足使用，应用中有很多定时任务需要执行

**有了集群之后，公司定时任务实现的方式**

随着用户的增加，访问量也就随之增加，一台服务器满足不了高并发的要求，因此公司把应用给部署到集群中，前端通过nginx代理（应用服务器ip可能是用防火墙进行了隔离，避免了直接使用ip+端口+应用名访问的方式）。在集群环境中，同样的定时任务，在集群中的每台机器都会执行，这样定时任务就会重复执行，不但会增加服务器的负担，还会因为定时任务重复执行造成额外的不可预期的错误，因此公司的解决方案是：根据集群的数量，来把定时任务中的任务平均分到集群中的每台机器上（这里的平均分是指以前一个定时任务本来是在一台机器上运行，先在人为的把这个任务分成几部分，让所有的机器都去执行这个人去）。

**目前集群中定时任务实现方式的缺陷**

目前公司在集群中处理定时任务的方式不是正真的分布式处理方式，而是一种伪分布式（公司内部俗称土方法），这种方式存在一个明显的缺陷就是当集群中机器宕机，那么整个定时任务就会挂掉或者不能一次性跑完，会对业务产生严重的影响。 

**针对缺陷的解决方案 **

利用`Spring + Quartz`构建一套真正的分布式定时任务系统，经过查阅相关资料得知：Quartz框架是原生就支持分布式定时任务的。

环境：`Intellij IDEA、JDK1.8+、Spring 4+、Quartz2.2.1`

 

 